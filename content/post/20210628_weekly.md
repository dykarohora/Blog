---
title: "2021å¹´6æœˆç¬¬4é€±ãƒ¬ãƒãƒ¼ãƒˆ"
slug: "20210628_weekly"
author: "d_yama"
date: 2021-06-28T09:45:00+09:00
draft: false
categories: ["Weekly Report"]
tags: []
---

# ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ
## ğŸ“ ã€ŒThe Road to GraphQLã€ã‚’èª­ã‚“ã§ã„ã‚‹

å…ˆé€±ã«å¼•ãç¶šãã€GraphQLã®å­¦ç¿’ã®ãŸã‚ä»¥ä¸‹ã®æ›¸ç±ã‚’èª­ã‚“ã§ã„ã¾ã™ã€‚

> [the-road-to-graphql/the-road-to-graphql: ğŸ““The Road to GraphQL: Your journey to master pragmatic GraphQL in JavaScript (github.com)](https://github.com/the-road-to-graphql/the-road-to-graphql)

<iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=7dyama-22&language=ja_JP&o=9&p=8&l=as4&m=amazon&f=ifr&ref=as_ss_li_til&asins=B07K5TF5LP&linkId=933589ee2cb4c3ecb8941621ddfe2e5f"></iframe>

ã“ã®æœ¬ã§å­¦ã¹ã‚‹å†…å®¹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚
- Github GraphQL APIã‚’é¡Œæã¨ã—ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã‹ã‚‰ã®åˆ©ç”¨æ–¹æ³•ï¼ˆ1ã€œ6ç« ï¼‰
- Reactã‚’ä½¿ã£ãŸGraphQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…ï¼ˆ7ç« ï¼‰
- Expressã‚’ä½¿ã£ãŸGraphQLã‚µãƒ¼ãƒã®å®Ÿè£…ï¼ˆ8ç« ï¼‰

7ç« ã®Reactã‚’ä½¿ã£ãŸå®Ÿè£…ã«ã¤ã„ã¦ã¯å†…å®¹ãŒå¤ãã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„ã€Hooksã«ã¤ã„ã¦ã®è¨€åŠãŒãªã„ã®ã§ã€è»½ãæµã—ã¦ã„ã¾ã™ã€‚

8ç« ã«ã¤ã„ã¦ã¯ãŠãã‚‰ãç¾åœ¨ã‚‚é€šç”¨ã™ã‚‹å†…å®¹ã‹ãªã€ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚ãŸã ã€å®Ÿè£…ã«ã¤ã„ã¦ã¯JavaScriptã«ã‚ˆã‚‹ã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚è‡ªåˆ†ã¯æ¼”ç¿’ã«ã¤ã„ã¦TypeScriptã§å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã§ã€é©å®œTypeScriptå‘ã‘ã®æƒ…å ±ã‚’åé›†ã—ãªãŒã‚‰èª­ã¿é€²ã‚ã¦ã„ã¾ã™ã€‚

ç¾åœ¨8ç« ã®ä¸­ç›¤ã¾ã§åˆ°é”ã—ã¦ã„ã‚‹ã®ã§ã¼ã¡ã¼ã¡çµ‚ç›¤ã¨ã„ã£ãŸã¨ã“ã‚ã§ã—ã‚‡ã†ã‹ã€‚èª­ã‚“ã æ„Ÿè§¦ã¨ã—ã¦ã¯å…¥é–€æ›¸ã¨ã—ã¦ã¯ã‹ãªã‚Šè‰¯ã„éƒ¨é¡ã ã¨æ€ã„ã¾ã™ã€‚å‰åŠã®ç« ã§ã¯åŸºç¤ãŒä¸å¯§ã«è§£èª¬ã•ã‚Œã¦ãŠã‚Šã€ã¾ãšã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã‚ãšç”Ÿã®HTTPé€šä¿¡ã‚’ä½¿ã£ã¦GraphQLã®åˆ©ç”¨æ–¹æ³•ã‚’ä½“æ„Ÿã—ã¦ã¿ã‚‹ã¨ã„ã†æ–¹é‡ã«å¥½æ„ŸãŒæŒã¦ã¾ã™ã€‚ã„ããªã‚ŠæŠ½è±¡åŒ–ã•ã‚ŒãŸä¾¿åˆ©ãªã‚‚ã®ã‚’ä½¿ã†ã‚ˆã‚Šã‚‚ã€ä½ã‚ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®æ–¹ãŒã€GraphQLãã®ã‚‚ã®ã®ç†è§£ã‚’æ·±ã‚ãŸã„äººã«ã¯å‘ã„ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚

ãã®å¾Œã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚‚ã‚µãƒ¼ãƒã‚‚ãƒ¡ã‚¸ãƒ£ãƒ¼ãªGraphQLã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹[Apollo](https://www.apollographql.com/)ã®åˆ©ç”¨æ–¹æ³•ã«å…¥ã‚‹ã®ã§ã€åŸºç¤ã‹ã‚‰å®Ÿè·µã¾ã§ã‚ã‚‹ç¨‹åº¦ã‚«ãƒãƒ¼ã§ãã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ãªã¨æ€ã„ã¾ã™ã€‚


## ğŸ“ GraphQLã‚µãƒ¼ãƒã‚’TypeScriptã§å®Ÿè£…ã™ã‚‹ã¨ãã®è«¸æƒ…å ±

å‰è¿°ã—ãŸã¨ãŠã‚ŠThe Road to GraphQLã®ã‚µãƒ³ãƒ—ãƒ«ã¯JavaScriptã§å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚è‡ªåˆ†ã¯ä»Šå¾ŒTypeScriptã§å®Ÿè£…ã—ã¦ä½¿ã£ã¦ã„ãäºˆå®šãªã®ã§ã€ã‚µãƒ³ãƒ—ãƒ«ã‚„æ¼”ç¿’ã¯TypeScriptã§å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€å‹ä»˜ã‘ã¾ã‚ã‚Šã§ã„ã‚ã„ã‚ã¨èª¿ã¹ã¦ã„ãä¸­ã§å‚è€ƒã¨ãªã£ãŸè¨˜äº‹ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚

> [Apollo Server with TypeScript (zenn.dev)](https://zenn.dev/intercept6/articles/3daca0298d32d8022e71)

ä½•ã¯ã¨ã‚‚ã‚ã‚Œãƒªã‚¾ãƒ«ãƒã‚’æ›¸ãã¨ãã«å‹ã®ã‚µãƒãƒ¼ãƒˆãŒæ¬²ã—ããªã‚Šã¾ã—ãŸã€‚ã©ã†ã‚„ã‚‰ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã‹ã‚‰å‹å®šç¾©ã‚’ç”Ÿæˆã™ã‚‹ã®ãŒãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã®ã‚ˆã†ã§ã™ã€‚`Apollo`ã§ã‚‚å‡ºæ¥ã‚‹ã‚ˆã†ã§ã™ãŒã€`graphql-codegen`ã®æ–¹ãŒã„ã‚ã„ã‚å‡ºæ¥ã‚‹ã“ã¨ãŒå¤šã„ã‚ˆã†ã§ã™ï¼ˆã¾ã ã‚ˆãã‚ã‹ã£ã¦ãªã„ã‘ã©ï¼‰ã€‚

ã“ã¡ã‚‰ã®è¨˜äº‹ã§ã¯`graphql-codegen`ã§ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰TypeScriptç”¨ã®å‹å®šç¾©ã‚’ç”Ÿæˆã™ã‚‹ã¾ã§ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‹ã‚‰ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§è§£èª¬ã•ã‚Œã¦ã„ã‚‹ã®ã§éå¸¸ã«å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã§å‹æ¨è«–ã‚’åŠ¹ã‹ã›ã¦ãƒªã‚¾ãƒ«ãƒã‚’æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã€ã ã„ã¶å¿«é©ã«å®Ÿè£…ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ã—ã‹ã—ã‚ã‚‹ç¨‹åº¦é€²ã‚“ã§ããŸã¨ã“ã‚ã§æ–°ãŸãªæ‚©ã¿ãƒã‚¤ãƒ³ãƒˆãŒå‡ºã¦ãã¾ã—ãŸã€‚Queryã«ã¤ã„ã¦ã®ãƒªã‚¾ãƒ«ãƒã«ã¤ã„ã¦ã¯å‹ãƒã‚§ãƒƒã‚¯ãŒå¯èƒ½ã«ãªã£ãŸã®ã§ã™ãŒã€Queryã‹ã‚‰Typeã¸ãƒãƒƒãƒ”ãƒ³ã‚°ï¼Ÿã—ãªãŒã‚‰è§£æ±ºã—ã¦ã„ããƒªã‚¾ãƒ«ãƒãŒã†ã¾ãæ›¸ã‘ãªã„ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚ãã“ã§ã„ã‚ã„ã‚èª¿ã¹ã¦ã¿ã‚‹ã¨ã€ã‚„ã‚ŠãŸã‹ã£ãŸã“ã¨ã«ãƒ”ãƒƒã‚¿ãƒªå½“ã¦ã¯ã¾ã‚‹è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚

> [Better Type Safety for your GraphQL resolvers with GraphQL Codegen - The Guild Blog (the-guild.dev)](https://the-guild.dev/blog/better-type-safety-for-resolvers-with-graphql-codegen)

`graphql-codegen`ã«ã¯è¨­å®šã§**mapper**ãŒè¨­å®šã§ãã‚‹ã‚ˆã†ã§ã€GraphQLã®Typeã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®å‹å®šç¾©ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã§ãã‚‹ã‚ˆã†ã§ã™ã€‚ãŸã¨ãˆã°æ¬¡ã®ã‚ˆã†ãªGraphQLã‚¹ã‚­ãƒ¼ãƒã‚’ç”¨æ„ã—ãŸã¨ã—ã¦

```graphql
type Query {
    users: [User!]
    user(id: ID!): User
    me: User
    messages: [Message!]!
    message(id: ID!): Message!
}

type User {
    id: ID!
    username: String!
    messages: [Message!]
}

type Message {
    id: ID!
    text: String!
    user: User
}

type Mutation {
    createMessage(text: String!): Message!
    deleteMessage(id: ID!): Boolean!
    updateMessage(id: ID!, text:String!): Boolean!
}
```

æ¬¡ã®ã‚ˆã†ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å‹å®šç¾©ã‚’ç”¨æ„ã™ã‚‹ã€‚

ãŸã¨ãˆã°ã€ã“ã“ã§ã¯GraphQLã®ã‚¹ã‚­ãƒ¼ãƒã§User Typeã¯Messgage Typeã®ãƒªã‚¹ãƒˆã‚’æŒã£ã¦ã„ã¾ã™ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®IDã®ãƒªã‚¹ãƒˆã‚’æŒã£ã¦ã„ã‚‹ã€ã¨ã„ã£ãŸå·®ç•°ãŒã‚ã‚‹ã¨ã—ã¦ã„ã¾ã™ã€‚ï¼ˆMessage Typeã‹ã‚‰User Typeã¸ã®é–¢é€£ã«ã¤ã„ã¦ã‚‚åŒæ§˜ï¼‰

```typescript
export type UserModel = {
    id: string
    username: string
    messageIds: string[]
}

export type MessageModel = {
    id: string
    text: string
    userId: string
}
```

ãã—ã¦`graphql-codegen`ã§ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚

```yml
overwrite: true
generates:
  ./src/types/generated/graphql.ts:
    schema: schema.graphql
    config:
      mappers:
        User: ./src/types/model/models#UserModel
        Message: ./src/types/model/models#MessageModel
      useIndexSignature: true
    plugins:
      - typescript
      - typescript-resolvers
```

ãã‚Œã§ç”Ÿæˆã•ã‚ŒãŸå‹å®šç¾©ã‚’ä½¿ã£ã¦ãƒªã‚¾ãƒ«ãƒã‚’æ›¸ãã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```typescript
const users: UserModel[] = [
    {
        id        : '1',
        username  : 'Nanoha Takamachi',
        messageIds: ['1']
    },
    {
        id        : '2',
        username  : 'Fate Testarossa',
        messageIds: ['2']
    },
    {
        id        : '3',
        username  : 'Hayate Yagami',
        messageIds: []
    }
]

const messages: MessageModel[] = [
    {
        id    : '1',
        text  : 'Hello, World',
        userId: '1'
    },
    {
        id    : '2',
        text  : 'Good Afternoon, World',
        userId: '2'
    },
    {
        id    : '3',
        text  : 'Good Bye, World',
        userId: '1'
    }
]

const resolvers: Resolvers = {
    Query   : {
        me      : (parent, args, context) => {
            return me
        },
        user    : (parent, args) => {
            const user = users.find(user => user.id === args.id)
            return user ?? null
        },
        users   : () => {
            return users
        },
        messages: () => {
            return messages
        },
        message : (parent, {id}) => {
            const message = messages.find(message => message.id === id)
            return message ?? {id: 'invalid', text: 'not found', userId: 'not found'}
        }
    },
    User    : {
        username: (parent, args, context, info) => {
            return parent.username
        },
        messages: (user) => {
            return messages.filter(msg => msg.userId === user.id)
        }
    },
    Message : {
        user: (message) => {
            const user = users.find(user => user.id === message.userId)
            return user ?? {id: '', username: '', messageIds: []}
        }
    }
}

```

ãŸã¨ãˆã°User Typeã®messagesãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒªã‚¾ãƒ«ãƒã®ã‚·ã‚°ãƒãƒãƒ£ã§ã™ãŒã€ç¬¬ä¸€å¼•æ•°ã®æ–¹ãŒ`UserModel`ã¨ãªã‚Šã¾ã™ã€‚ãƒãƒƒãƒ”ãƒ³ã‚°ã—ãªã„å ´åˆã¯GraphQLã®User Typeã¨åŒã˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã¤`User`å‹ã¨ãªã‚‹ã®ã§ã™ãŒã€ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å‹ã«å‹ä»˜ã‘ã•ã‚ŒãŸå½¢ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒªã‚¾ãƒ«ãƒã‚’æ›¸ãã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

# ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ

ç›®ç«‹ã£ãŸã‚‚ã®ã¯ãªã—ã€‚












