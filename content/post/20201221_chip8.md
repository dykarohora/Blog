---
title: "2020年12月第3週レポート"
slug: "20201221_weekly"
author: "d_yama"
date: 2020-12-21T09:45:00+09:00
draft: false
categories: ["Weekly Report"]
tags: ["Power Automate"]
---
# Chip-8とは

# CPUについておさらいした

マンガでわかるCPUをよんで用語をまなぶ

# Chip-8のリファレンスを読む

* Chip-8は4KBのRAMを持つ
    * 先頭512バイト(0x000-0x1FF)はインタプリタが使う
* Chip-8は16個の8ビットレジスタを持つ
* Chip-8はメモリアドレスを格納するための16ビットレジスタを1個持つ
    * メモリマップは0x000-0xFFFなので12ビットでアドレスを表現できる
* delayとサウンドタイマー
* プログラムカウンタは16ビット
* スタックポインタは8ビット
* スタックは16個の16ビットの配列

* ディスプレイは64*32ピクせうる

# 設計


# 作る


## RAM
わかりやすいRAMから作っていく

## バス

CPUはバスを通じてRAMからデータを読み取ったり書き込んだりする


http://www.multigesture.net/articles/how-to-write-an-emulator-chip-8-interpreter/

## CPU
レジスタの定義

テストROMが動くように命令セットを実装していく

0x1nnn - JMP

0x6xKK - VxにKKをセットする
test3xのところまで

0xAnnn - Iレジスタにnnnをセットする

0xDxyn - IレジスタのnバイトをVx Vyに描画する

## Displayの実装
64*32のモノクロディスプレイ
64*32bit = 256byteのビデオメモリがあるようなイメージ

排他的論理和、衝突判定？

とりあえず標準出力

## CPU再び

0x3xkk - Vxレジスタの値がkkに等しいの場合は次の命令をスキップする
0x4xkk - Vxレジスタの値がkkに等しくない場合は次の命令をスキップする
0x5xy0 - VxとVyの値を比較し、等しければ次の命令をスキップする
0x9xy0 - VxとVyの値を比較し、等しくなければ次の命令をスキップする
条件分岐に使えるね

0x7xkk - VxレジスタにVx+kkをセットする
桁溢れする
wrapping_addを使う

サブルーチンコール
0x2nnn - nnnにあるサブルーチンを呼び出す
0x00EE - スタックの一番上の値をプログラムカウンタにセットする


レジスタからレジスタへの代入
0x8xy0 - VxにVyを代入する。
0x8xy1 - Vxに Vx OR Vyを代入する。 論理演算
0x8xy2 - Vxに Vx AND Vyを代入する。　論理演算
0x8xy3 - Vxに Vx XOR Vyを代入する。　論理演算
0x8xy4 - Vxに Vx + Vyを代入する。結果が8bitから溢れた場合はVFに1をセットする 算術演算
0x8xy5 - Vxに Vx - Vyを代入する。オーバーフローした場合はVFに0をセットする 算術演算
0x8xy6 - Vxの最下位ビットをVfにセットしてVxを右に1ビットシフトする 2で割る
0x8xyE - Vxの最上位ビットをVfにセットしてVxを左に1ビットシフトする 2倍
(テストROM、0x8xy6と0x8xyEのテスト逆じゃね…)

0xFx55 - V0からVxまでの値をIから始まるアドレスに順番にセットしている
0xFx65 - アドレスIから読んだ値をV0からVxにセットしていく

0xFx33 - Vxにセットされている値の10進数表現をI I+1 I+2にセットしていく


ここまででテストROMが動く

## 画面描画
minifbを使った

## クロック？？

## 残りのめいれい

0xFx29 →IにVxの値(0-F)に対応するスプライトのアドレスをセットする。

0xFx15
0xFx07

0xFxIE

0xEx93 キーボード
0xExA1 キーボード

0xFx18 サウンドタイマー

0x00E0 画面クリア